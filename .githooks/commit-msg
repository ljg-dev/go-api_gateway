#!/usr/bin/env bash
set -euo pipefail

msg_file="$1"
first_line="$(head -n1 "$msg_file" | tr -d '\r')"

# Conventional Commits (subject line)
# Examples: "feat(parser): add arrays", "fix!: drop Node 12", "docs: update README"
commit_regex='^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\([A-Za-z0-9._/-]+\))?(!)?: .+'

if ! printf '%s' "$first_line" | grep -Eq "$commit_regex"; then
  cat <<EOF
âŒ Invalid commit message subject:

$first_line

Expected pattern:
  $commit_regex

Learn more: https://www.conventionalcommits.org/en/v1.0.0/
EOF
  exit 1
fi
